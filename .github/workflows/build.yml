- name: 安装 eBPF 编译依赖
        run: |
          sudo apt-get update
          # 安装基础工具
          sudo apt-get install -y clang llvm libbpf-dev gcc-multilib libelf-dev
          
          # 下载官方 libbpf 维护的静态版 bpftool (v7.5.0)
          curl -L https://github.com/libbpf/bpftool/releases/download/v7.5.0/bpftool-v7.5.0-amd64.tar.gz | sudo tar -xz -C /usr/local/bin
          
          # 【关键修复】强制删除系统自带的冲突占位符，并建立软链接
          sudo rm -f /usr/bin/bpftool
          sudo ln -sf /usr/local/bin/bpftool /usr/bin/bpftool
          
          # 验证（使用绝对路径或确认软链接生效）
          /usr/local/bin/bpftool version
          clang --version

      - name: 构建 eBPF 程序
        # 如果你的 Makefile 里直接用了 bpftool 命令，现在它已经指向正确的二进制了
        run: make ebpf
